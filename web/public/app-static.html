<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morkis — The Honesty Monster</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/yevhenii-kalashnyk/image/upload/e_background_removal/c_fill,ar_3:4,g_auto,f_png/v1771693879/Gemini_Generated_Image_3goprg3goprg3gop_l9flik.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;600;700;800&family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#F7F7F7',
                        ink: '#3C3C3C',
                        moss: '#006D5B',
                        mint: '#A8E6CF',
                        coral: '#FF4B4B',
                        sunshine: '#FFC800',
                        lavender: '#CE82FF',
                        sky: '#1CB0F6',
                        muted: '#AFAFAF',
                        bite: '#FF4B4B',
                        chill: '#006D5B',
                    },
                    fontFamily: {
                        display: ['Bricolage Grotesque', 'sans-serif'],
                        body: ['DM Sans', 'sans-serif'],
                        mono: ['Space Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { background: #FFFFFF; color: #3C3C3C; font-family: 'DM Sans', sans-serif; font-size: 16px; line-height: 1.45; }

        .screen { display: none; }
        .screen.active { display: block; }

        .card {
            background: #fff;
            border: 2px solid #E5E5E5;
            border-radius: 1rem;
        }
        .card-hover { transition: transform 0.2s, box-shadow 0.2s; }
        .card-hover:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.06); transform: translateY(-2px); }

        .btn {
            border: none;
            border-radius: 999px;
            font-family: 'Bricolage Grotesque', sans-serif;
            font-weight: 700;
            box-shadow: 0 4px 0 rgba(0,0,0,0.15);
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
            top: 0;
        }
        .btn:active, .btn:hover {
            box-shadow: 0 2px 0 rgba(0,0,0,0.15);
            top: 2px;
        }

        @keyframes float {
            0%,100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .float { animation: float 3.5s ease-in-out infinite; }

        @keyframes wiggle {
            0%,100% { transform: rotate(0deg); }
            25% { transform: rotate(-4deg); }
            75% { transform: rotate(4deg); }
        }
        .wiggle { animation: wiggle 0.5s ease; }

        .marker { background: linear-gradient(180deg, transparent 60%, rgba(0, 109, 91, 0.2) 40%); padding: 0 2px; }

        input[type="range"] {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 10px;
            border-radius: 999px; background: #E5E5E5;
            border: none; outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 28px; height: 28px;
            border-radius: 50%; background: #006D5B;
            border: none; cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }

        /* Mobile tab bar */
        .mobile-tabs {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #fff; border-top: 1px solid #E5E5E5;
            padding: 6px 0 calc(6px + env(safe-area-inset-bottom));
            z-index: 50; display: flex;
        }
        @media(min-width:768px) { .mobile-tabs { display: none !important; } }

        .tab { flex:1; display:flex; flex-direction:column; align-items:center; gap:2px; padding:4px 0; cursor:pointer; color:#AFAFAF; }
        .tab.active svg { color: #006D5B; }
        .tab.active span { color: #006D5B; }

        /* Desktop nav */
        .desktop-nav { display: none; }
        @media(min-width:768px) {
            .desktop-nav {
                display: flex; position: fixed; top: 0; left: 0; right: 0;
                background: rgba(247,247,247,0.9); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
                border-bottom: 1px solid rgba(60,60,60,0.1); z-index: 50;
            }
        }
    </style>
</head>
<body>

<!-- ======== DESKTOP NAV ======== -->
<nav class="desktop-nav">
    <div class="max-w-7xl mx-auto w-full px-6 py-4 flex items-center justify-between">
        <a href="/" class="flex items-center gap-2 no-underline">
            <img src="https://res.cloudinary.com/yevhenii-kalashnyk/image/upload/e_background_removal/c_fill,ar_3:4,g_auto,f_png/v1771693879/Gemini_Generated_Image_3goprg3goprg3gop_l9flik.png" alt="Morkis" class="w-8 h-10 object-contain">
            <span class="font-display text-xl tracking-wide text-ink">MORKIS</span>
        </a>
        <div class="flex items-center gap-1">
            <button onclick="goTo('screen-home')" class="nav-link px-4 py-2 rounded-full font-display text-sm font-bold text-ink/50 hover:bg-ink/5 transition-colors" data-screen="screen-home">Home</button>
            <button onclick="goTo('screen-contract')" class="nav-link px-4 py-2 rounded-full font-display text-sm font-bold text-ink/50 hover:bg-ink/5 transition-colors" data-screen="screen-contract">New Pact</button>
            <!-- Group tab (temporarily hidden)
            <button onclick="goTo('screen-group')" class="nav-link px-4 py-2 rounded-full font-display text-sm font-bold text-ink/50 hover:bg-ink/5 transition-colors" data-screen="screen-group">Group</button>
            -->
            <button onclick="goTo('screen-shop')" class="nav-link px-4 py-2 rounded-full font-display text-sm font-bold text-ink/50 hover:bg-ink/5 transition-colors" data-screen="screen-shop">Shop</button>
        </div>
        <div class="flex items-center gap-3">
            <div class="card px-3 py-1 flex items-center gap-1.5" style="border-width:2px;">
                <span class="font-mono text-[10px] text-muted uppercase tracking-widest">IP</span>
                <span class="font-display text-sm font-extrabold text-moss">2,340</span>
            </div>
            <div class="w-8 h-8 bg-moss/10 border-2 border-ink rounded-full flex items-center justify-center text-xs font-bold text-moss">EK</div>
        </div>
    </div>
</nav>

<!-- ======== MOBILE TAB BAR ======== -->
<div class="mobile-tabs" id="mobile-tabs">
    <div class="tab active" onclick="goTo('screen-home')" data-screen="screen-home">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/></svg>
        <span class="font-display text-[9px] font-bold">Home</span>
    </div>
    <div class="tab" onclick="goTo('screen-contract')" data-screen="screen-contract">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
        <span class="font-display text-[9px] font-bold">Pact</span>
    </div>
    <!-- Group mobile tab (temporarily hidden)
    <div class="tab" onclick="goTo('screen-group')" data-screen="screen-group">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
        <span class="font-display text-[9px] font-bold">Group</span>
    </div>
    -->
    <div class="tab" onclick="goTo('screen-shop')" data-screen="screen-shop">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
        <span class="font-display text-[9px] font-bold">Shop</span>
    </div>
</div>

<!-- ================================ -->
<!-- SCREEN: HOME                     -->
<!-- ================================ -->
<div id="screen-home" class="screen active">
    <div class="max-w-5xl mx-auto w-full px-5 pt-6 pb-28 md:pt-24 md:pb-16">

        <!-- Mobile greeting -->
        <div class="flex items-center justify-between mb-6 md:hidden">
            <div>
                <div class="font-display text-xl font-extrabold">Hey, Erik</div>
            </div>
            <div class="flex items-center gap-2">
                <div class="card px-3 py-1 flex items-center gap-1.5" style="border-width:2px;">
                    <span class="font-mono text-[10px] text-muted uppercase tracking-widest">IP</span>
                    <span class="font-display text-base font-extrabold text-moss">2,340</span>
                </div>
                <div class="w-8 h-8 bg-moss/10 border-2 border-ink rounded-full flex items-center justify-center text-xs font-bold text-moss">EK</div>
            </div>
        </div>

        <!-- Desktop greeting -->
        <div class="hidden md:flex items-center justify-between mb-8">
            <div>
                <div class="font-display text-3xl font-extrabold">Hey, Erik</div>
            </div>
        </div>

        <!-- Main grid: desktop 2-col, mobile stack -->
        <div class="grid md:grid-cols-5 gap-6">

            <!-- Left column (3/5) -->
            <div class="md:col-span-3 space-y-6">

                <!-- Morkis Habitat -->
                <div class="card p-6 text-center" style="border-color: #006D5B;">
                    <div class="float inline-block">
                        <img src="https://res.cloudinary.com/yevhenii-kalashnyk/image/upload/e_background_removal/c_fill,ar_3:4,g_auto,f_png/v1771693879/Gemini_Generated_Image_3goprg3goprg3gop_l9flik.png" alt="Morkis" class="w-24 md:w-32 object-contain mx-auto">
                    </div>
                    <div class="mt-3 font-display text-base font-bold text-moss">€340 saved by fear</div>
                </div>

                <!-- Active Pacts -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <div class="font-display text-base font-bold uppercase tracking-widest">Active Pacts</div>
                    </div>
                    <div class="space-y-3" id="pact-list">
                        <div class="card p-4" style="border-color: #006D5B;">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-moss/10 border-2 border-moss rounded-lg flex items-center justify-center"><i data-lucide="utensils" class="w-5 h-5 text-moss"></i></div>
                                    <div>
                                        <div class="font-display text-base font-bold">No Wolt this week</div>
                                        <div class="font-mono text-xs text-muted">3 days remaining</div>
                                    </div>
                                </div>
                                <div class="font-display text-base font-extrabold text-moss">€30</div>
                            </div>
                            <div class="w-full h-3 bg-cream border-2 border-ink/10 rounded-full overflow-hidden">
                                <div class="h-full bg-moss rounded-full" style="width:57%"></div>
                            </div>
                            <div class="flex justify-between mt-1.5">
                                <span class="font-mono text-xs text-muted">Day 4/7</span>
                                <span class="font-mono text-xs text-moss font-bold">On track ✓</span>
                            </div>
                        </div>

                        <div class="card p-4 cursor-pointer" style="border-color: #FF4B4B;" onclick="goTo('screen-bite')">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-coral/10 border-2 border-coral rounded-lg flex items-center justify-center"><i data-lucide="coffee" class="w-5 h-5 text-coral"></i></div>
                                    <div>
                                        <div class="font-display text-base font-bold">Max 2 fikas this week</div>
                                        <div class="font-mono text-xs text-coral"><i data-lucide="alert-triangle" class="w-3 h-3 inline text-coral"></i> 2/2 used — careful!</div>
                                    </div>
                                </div>
                                <div class="font-display text-base font-extrabold text-coral">€20</div>
                            </div>
                            <div class="w-full h-3 bg-cream border-2 border-ink/10 rounded-full overflow-hidden">
                                <div class="h-full bg-coral rounded-full" style="width:85%"></div>
                            </div>
                            <div class="flex justify-between mt-1.5">
                                <span class="font-mono text-xs text-muted">Day 6/7</span>
                                <span class="font-mono text-xs text-coral font-bold">Danger zone</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right column (2/5) -->
            <div class="md:col-span-2 space-y-6">

                <!-- Quick Actions -->
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="goTo('screen-contract')" class="btn px-3 py-3 bg-moss text-white text-sm uppercase tracking-widest">+ New Pact</button>
                    <!-- Group quick action (temporarily hidden)
                    <button onclick="goTo('screen-group')" class="btn px-3 py-3 bg-cream text-ink border-2 border-ink/10 text-sm uppercase tracking-widest"><i data-lucide="users" class="w-4 h-4 inline mr-1"></i>Group</button>
                    -->
                </div>

                <!-- My Nemesis Organizations -->
                <div class="card p-4">
                    <div class="font-display text-sm font-bold uppercase tracking-widest mb-3">My Nemesis Organizations</div>
                    <form id="org-form" onsubmit="saveOrganization(event)" class="space-y-2">
                        <input id="org-name" type="text" required class="w-full bg-cream border-2 border-ink/10 rounded-xl px-3 py-2.5 font-body text-sm text-ink placeholder:text-ink/30 focus:border-moss focus:outline-none transition-colors" placeholder="Name (e.g. Rival Candidate)">
                        <div class="grid grid-cols-2 gap-2">
                            <select id="org-type" class="w-full bg-cream border-2 border-ink/10 rounded-xl px-3 py-2.5 font-body text-sm text-ink focus:border-moss focus:outline-none transition-colors">
                                <option value="politician">Politician</option>
                                <option value="the_ex">The Ex</option>
                                <option value="influencer">Influencer</option>
                            </select>
                            <input id="org-iban" type="text" class="w-full bg-cream border-2 border-ink/10 rounded-xl px-3 py-2.5 font-body text-sm text-ink placeholder:text-ink/30 focus:border-moss focus:outline-none transition-colors" placeholder="IBAN (optional)">
                        </div>
                        <input id="org-extra" type="text" class="w-full bg-cream border-2 border-ink/10 rounded-xl px-3 py-2.5 font-body text-sm text-ink placeholder:text-ink/30 focus:border-moss focus:outline-none transition-colors" placeholder="Extra info (optional)">
                        <button type="submit" class="btn w-full px-4 py-2.5 bg-moss text-white text-xs uppercase tracking-widest">Save Organization</button>
                    </form>
                    <div id="org-list" class="mt-3 space-y-2"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ================================ -->
<!-- SCREEN: NEW PACT (CONTRACT)      -->
<!-- ================================ -->
<div id="screen-contract" class="screen">
    <div class="max-w-lg mx-auto w-full px-5 pt-6 pb-28 md:pt-24 md:pb-16">

        <button onclick="goTo('screen-home')" class="md:hidden mb-4 card w-8 h-8 flex items-center justify-center" style="border-width:2px;">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="#3C3C3C" stroke-width="2.5" stroke-linecap="round"><path d="M10 3L5 8L10 13"/></svg>
        </button>

        <div class="font-display text-2xl font-extrabold mb-5">New Pact</div>

        <!-- Pact Card -->
        <div class="card p-5 mb-5" style="border-style:dashed; border-color:#006D5B;">
            <div class="font-display text-sm font-bold text-ink/40 uppercase tracking-widest mb-2">I promise to...</div>
            <div class="flex gap-2 mb-3">
                <input type="text" id="pact-input" class="flex-1 bg-cream border-2 border-ink/10 rounded-xl px-3 py-2.5 font-display text-base font-bold text-ink placeholder:text-ink/30 focus:border-moss focus:outline-none transition-colors" placeholder="Type your promise here...">
                <button onclick="addPact()" class="px-4 bg-moss text-white rounded-xl font-display text-xs font-bold uppercase tracking-widest hover:bg-moss/90 transition-colors" title="Add pact">Add</button>
            </div>
            <div id="pact-display" class="bg-cream border-2 border-moss rounded-xl p-3 mb-4 hidden">
                <div class="flex items-center justify-between">
                    <div class="font-display text-base font-bold text-moss" id="pact-text"></div>
                    <button onclick="clearPact()" class="text-ink/30 hover:text-coral text-lg leading-none">&times;</button>
                </div>
            </div>

            <div class="border-t-2 border-dashed border-ink/10 -mx-5 mb-5"></div>

            <!-- Stake -->
            <div class="text-center mb-3">
                <div class="font-mono text-xs text-muted uppercase tracking-[0.2em] mb-1">YOUR STAKE</div>
                <div class="font-display text-4xl font-extrabold" id="stake-display">€30</div>
            </div>
            <div class="flex justify-center mb-3">
                <div class="relative inline-block">
                    <img src="https://res.cloudinary.com/yevhenii-kalashnyk/image/upload/e_background_removal/c_fill,ar_3:4,g_auto,f_png/v1771693879/Gemini_Generated_Image_3goprg3goprg3gop_l9flik.png" alt="Morkis" class="w-14 h-18 object-contain" id="stake-morkis">
                    <div class="absolute -top-2 -right-14 card px-2 py-1 text-xs font-display font-bold text-moss whitespace-nowrap" id="morkis-reaction" style="border-width:2px;">Not bad!</div>
                </div>
            </div>
            <input type="range" min="1" max="100" value="30" step="1" id="stake-slider" oninput="updateStake(this.value)">
            <div class="flex justify-between mt-1">
                <span class="font-mono text-xs text-muted">€1</span>
                <span class="font-mono text-xs text-muted">€100</span>
            </div>
        </div>

        <!-- Duration -->
        <div class="mb-5">
            <div class="font-display text-sm font-bold uppercase tracking-widest mb-3">Duration</div>
            <div class="flex gap-2">
                <button class="flex-1 py-3 bg-moss text-white border-2 border-ink rounded-xl font-display text-sm font-bold duration-btn active">7 days</button>
                <button class="flex-1 py-3 bg-cream text-ink border-2 border-ink/10 rounded-xl font-display text-sm font-bold duration-btn" onclick="selectDuration(this)">14 days</button>
                <button class="flex-1 py-3 bg-cream text-ink border-2 border-ink/10 rounded-xl font-display text-sm font-bold duration-btn" onclick="selectDuration(this)">30 days</button>
            </div>
        </div>

        <!-- Where does your money go? -->
        <div class="mb-5">
            <div class="font-display text-sm font-bold uppercase tracking-widest mb-1">If you fail, your money goes to...</div>
            <div class="font-mono text-xs text-muted mb-3">Use saved organizations from Home. Add at least one to continue.</div>
            <div class="space-y-2 mb-4" id="nemesis-list"></div>
            <div id="nemesis-empty" class="hidden rounded-xl border-2 border-dashed border-ink/20 bg-cream p-4 text-center">
                <div class="font-display text-sm font-bold text-ink/60">No saved organizations yet.</div>
                <div class="font-mono text-xs text-muted mt-1">Go to Home and add one in “My Nemesis Organizations”.</div>
            </div>
        </div>

        <!-- Sign -->
        <button onclick="signPact()" class="btn w-full px-6 py-4 bg-moss text-white text-base uppercase tracking-widest">
            <i data-lucide="pen-line" class="w-4 h-4 inline mr-1"></i> Sign the Pact
        </button>
        <p class="font-mono text-xs text-muted text-center mt-2 mb-4">By signing, you agree Morkis owns your dignity.</p>
    </div>
</div>

<!-- SCREEN: GROUP PACT removed (preserved in git history) -->

<!-- ================================ -->
<!-- SCREEN: THE BITE (LOSS)          -->
<!-- ================================ -->
<div id="screen-bite" class="screen">
    <div class="max-w-lg mx-auto w-full px-5 pt-10 pb-28 md:pt-28 md:pb-16 flex flex-col items-center">

        <img src="https://res.cloudinary.com/yevhenii-kalashnyk/image/upload/e_background_removal/c_fill,ar_3:4,g_auto,f_png/v1771693879/Gemini_Generated_Image_3goprg3goprg3gop_l9flik.png" alt="Morkis" class="w-28 h-36 object-contain mb-4 drop-shadow-[0_4px_12px_rgba(255,107,107,0.3)]">

        <div class="font-display text-lg font-extrabold text-coral uppercase tracking-[0.2em] mb-1">MORKIS HAS BITTEN</div>
        <div class="font-body text-base text-muted mb-4">You broke your word. Here’s what happened:</div>

        <!-- Receipt -->
        <div class="w-full card p-5 mb-5" style="border-style:dashed;">
            <div class="font-mono text-xs text-muted uppercase tracking-[0.2em] mb-3">BITE RECEIPT — #MK-4491</div>
            <div class="font-display text-4xl font-extrabold text-coral text-center mb-1">€30.00</div>
            <div class="font-body text-base text-muted text-center mb-4">captured & transferred via Stripe</div>
            <div class="border-t-2 border-dashed border-ink/10 pt-3 space-y-2">
                <div class="flex justify-between"><span class="font-mono text-xs text-muted uppercase">Pact</span><span class="font-display text-sm font-bold">No Wolt this week</span></div>
                <div class="flex justify-between"><span class="font-mono text-xs text-muted uppercase">Broken</span><span class="font-display text-sm font-bold text-coral">Thu 01:47 AM</span></div>
                <div class="flex justify-between"><span class="font-mono text-xs text-muted uppercase">Trigger</span><span class="font-display text-sm font-bold">Wolt — €34.90</span></div>
                <div class="flex justify-between"><span class="font-mono text-xs text-muted uppercase">Sent to</span><span class="font-display text-sm font-bold text-coral">The Politician</span></div>
            </div>
        </div>

        <!-- Roast -->
        <div class="w-full p-4 mb-5 rounded-xl" style="background:#FF4B4B08;">
            <div class="font-display text-sm font-bold text-coral uppercase tracking-widest mb-2">Your Roast</div>
            <div class="bg-cream border-2 border-ink/5 rounded-xl p-3">
                <p class="font-display text-sm font-semibold text-ink/70 italic leading-relaxed">
                    "Oh look, Erik ordered Wolt at 1:47 AM. On a Thursday. The Politician just got <span class="text-coral font-extrabold not-italic">€30 richer.</span> Sweet dreams."
                </p>
            </div>
        </div>

        <div class="w-full grid grid-cols-2 gap-3 mb-5">
            <div class="p-3 text-center"><div class="font-display text-xl font-extrabold text-coral">-180</div><div class="font-mono text-xs text-muted uppercase">IP Lost</div></div>
            <div class="p-3 text-center"><div class="font-display text-xl font-extrabold text-coral"><i data-lucide="heart-off" class="w-5 h-5 text-coral mx-auto"></i></div><div class="font-mono text-xs text-muted uppercase">Streak Broken</div></div>
        </div>

        <button onclick="goTo('screen-home')" class="btn w-full px-6 py-4 bg-ink text-white text-base uppercase tracking-widest">
            I Accept My Shame
        </button>
    </div>
</div>

<!-- ================================ -->
<!-- SCREEN: MONSTER SHOP             -->
<!-- ================================ -->
<div id="screen-shop" class="screen">
    <div class="max-w-2xl mx-auto w-full px-5 pt-6 pb-28 md:pt-24 md:pb-16">

        <button onclick="goTo('screen-home')" class="md:hidden mb-4 card w-8 h-8 flex items-center justify-center" style="border-width:2px;">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="#3C3C3C" stroke-width="2.5" stroke-linecap="round"><path d="M10 3L5 8L10 13"/></svg>
        </button>

        <div class="flex items-center justify-between mb-5">
            <div class="font-display text-2xl font-extrabold">Monster Shop</div>
            <div class="card px-3 py-1 font-display text-sm font-extrabold text-moss" style="border-width:2px;">2,340 IP</div>
        </div>

        <p class="font-body text-base text-muted mb-5">Prove you’re disciplined enough to dress your monster.</p>

        <!-- Current Morkis -->
        <div class="card p-6 mb-5 text-center" style="background:linear-gradient(180deg,#D0ECE6,#E0F5F0);">
            <div class="float inline-block relative">
                <img src="https://res.cloudinary.com/yevhenii-kalashnyk/image/upload/e_background_removal/c_fill,ar_3:4,g_auto,f_png/v1771693879/Gemini_Generated_Image_3goprg3goprg3gop_l9flik.png" alt="Morkis" class="w-24 object-contain mx-auto">
                <div class="absolute -top-4 left-1/2 -translate-x-1/2"><i data-lucide="crown" class="w-6 h-6 text-sunshine"></i></div>
            </div>
            <div class="mt-2 font-display text-sm font-bold text-moss">YOUR MORKIS — LVL 12</div>
        </div>

        <!-- Items -->
        <div class="font-display text-sm font-bold uppercase tracking-widest mb-3">Cosmetics</div>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
            <div class="card p-4 text-center" style="border-color:#006D5B;">
                <div class="text-2xl mb-2"><i data-lucide="crown" class="w-6 h-6 text-sunshine mx-auto"></i></div>
                <div class="font-display text-sm font-bold">Tiny Crown</div>
                <div class="mt-1.5 px-2 py-0.5 bg-moss/10 rounded-full font-mono text-xs text-moss font-bold inline-block">OWNED ✓</div>
            </div>
            <div class="card p-4 text-center card-hover cursor-pointer">
                <div class="text-2xl mb-2"><i data-lucide="sparkles" class="w-6 h-6 text-sunshine mx-auto"></i></div>
                <div class="font-display text-sm font-bold">Golden Tooth</div>
                <div class="mt-1.5 px-2 py-0.5 bg-sunshine/20 rounded-full font-mono text-xs text-ink/60 font-bold inline-block">800 IP</div>
            </div>
            <div class="card p-4 text-center card-hover cursor-pointer">
                <div class="text-2xl mb-2"><i data-lucide="wind" class="w-6 h-6 text-chill mx-auto"></i></div>
                <div class="font-display text-sm font-bold">Nordic Scarf</div>
                <div class="mt-1.5 px-2 py-0.5 bg-sunshine/20 rounded-full font-mono text-xs text-ink/60 font-bold inline-block">500 IP</div>
            </div>
            <div class="card p-4 text-center opacity-50">
                <div class="text-2xl mb-2"><i data-lucide="flame" class="w-6 h-6 text-coral mx-auto"></i></div>
                <div class="font-display text-sm font-bold">Flame Aura</div>
                <div class="mt-1.5 px-2 py-0.5 bg-coral/10 rounded-full font-mono text-xs text-coral font-bold inline-block">3,000 IP</div>
            </div>
            <div class="card p-4 text-center opacity-50">
                <div class="text-2xl mb-2"><i data-lucide="graduation-cap" class="w-6 h-6 text-ink/40 mx-auto"></i></div>
                <div class="font-display text-sm font-bold">Top Hat</div>
                <div class="mt-1.5 px-2 py-0.5 bg-coral/10 rounded-full font-mono text-xs text-coral font-bold inline-block">5,000 IP</div>
            </div>
            <div class="card p-4 text-center opacity-50">
                <div class="text-2xl mb-2"><i data-lucide="gem" class="w-6 h-6 text-ink/40 mx-auto"></i></div>
                <div class="font-display text-sm font-bold">Diamond Eyes</div>
                <div class="mt-1.5 px-2 py-0.5 bg-coral/10 rounded-full font-mono text-xs text-coral font-bold inline-block">10,000 IP</div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentScreen = 'screen-home';
    const DEFAULT_ORGANIZATIONS = [];
    let failureRoastAudio = null;
    let failureRoastUrl = null;
    let failureRoastLoading = false;
    let organizations = [];
    let selectedNemesisId = null;

    function escapeHtml(text) {
        return String(text || '')
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/\"/g, '&quot;')
            .replace(/'/g, '&#039;');
    }

    function getOrgTypeLabel(type) {
        if (type === 'politician') return 'Politician';
        if (type === 'the_ex') return 'The Ex';
        if (type === 'influencer') return 'Influencer';
        return 'Custom';
    }

    function getOrgIcon(type) {
        if (type === 'politician') return 'landmark';
        if (type === 'the_ex') return 'heart-crack';
        if (type === 'influencer') return 'megaphone';
        return 'building-2';
    }

    function loadOrganizations() {
        try {
            const raw = localStorage.getItem('morkis-organizations');
            if (!raw) {
                organizations = [...DEFAULT_ORGANIZATIONS];
                return;
            }
            const parsed = JSON.parse(raw);
            organizations = Array.isArray(parsed) ? parsed : [...DEFAULT_ORGANIZATIONS];
        } catch (e) {
            organizations = [...DEFAULT_ORGANIZATIONS];
        }
    }

    function saveOrganizations() {
        localStorage.setItem('morkis-organizations', JSON.stringify(organizations));
    }

    function renderOrganizationsList() {
        const list = document.getElementById('org-list');
        if (!list) return;
        list.innerHTML = organizations.map(org => `
            <div class="bg-cream border-2 border-ink/10 rounded-xl p-3">
                <div class="flex items-center justify-between gap-2">
                    <div class="min-w-0">
                        <div class="font-display text-sm font-bold text-ink truncate">${escapeHtml(org.name)}</div>
                        <div class="font-mono text-[10px] text-muted">${escapeHtml(getOrgTypeLabel(org.type))}${org.iban ? ` · ${escapeHtml(org.iban)}` : ''}</div>
                        ${org.extra ? `<div class="font-body text-xs text-ink/60 mt-1">${escapeHtml(org.extra)}</div>` : ''}
                    </div>
                    <button type="button" onclick="deleteOrganization('${escapeHtml(org.id)}')" class="text-coral text-xs font-bold uppercase tracking-widest">Remove</button>
                </div>
            </div>
        `).join('');
    }

    function renderNemesisOptions() {
        const list = document.getElementById('nemesis-list');
        const empty = document.getElementById('nemesis-empty');
        if (!list) return;

        if (!organizations.length) {
            selectedNemesisId = null;
            list.innerHTML = '';
            if (empty) empty.classList.remove('hidden');
            return;
        }

        if (!selectedNemesisId || !organizations.some(org => org.id === selectedNemesisId)) {
            selectedNemesisId = organizations[0].id;
        }

        if (empty) empty.classList.add('hidden');
        list.innerHTML = organizations.map((org) => `
            <div class="bg-cream border-2 rounded-xl p-3 flex items-center gap-3 cursor-pointer nemesis-option" onclick="selectNemesis(this)" style="${selectedNemesisId === org.id ? 'border-color:#006D5B; background:#006D5B08;' : 'border-color:rgba(60,60,60,0.1); background:#F7F7F7;'}" data-org-id="${escapeHtml(org.id)}">
                <span class="w-8 h-8 bg-bite/10 border-2 border-ink/20 rounded-lg flex items-center justify-center"><i data-lucide="${escapeHtml(getOrgIcon(org.type))}" class="w-4 h-4 text-bite"></i></span>
                <div class="flex-1 min-w-0">
                    <div class="font-display text-base font-bold truncate">${escapeHtml(org.name)}</div>
                    <div class="font-mono text-xs text-muted">${escapeHtml(getOrgTypeLabel(org.type))}${org.iban ? ` · ${escapeHtml(org.iban)}` : ''}${org.extra ? ` · ${escapeHtml(org.extra)}` : ''}</div>
                </div>
                <div class="nemesis-check w-5 h-5 border-2 rounded-full ${selectedNemesisId === org.id ? 'border-moss bg-moss text-white' : 'border-ink/20'} flex items-center justify-center text-[10px] font-black" style="line-height:1">${selectedNemesisId === org.id ? '✓' : ''}</div>
            </div>
        `).join('');

        lucide.createIcons();
    }

    function saveOrganization(event) {
        event.preventDefault();
        const name = document.getElementById('org-name').value.trim();
        const type = document.getElementById('org-type').value;
        const iban = document.getElementById('org-iban').value.trim();
        const extra = document.getElementById('org-extra').value.trim();

        if (!name) return;

        organizations.push({
            id: `org-${Date.now()}`,
            name,
            type,
            iban,
            extra
        });

        saveOrganizations();
        renderOrganizationsList();
        renderNemesisOptions();

        event.target.reset();
        document.getElementById('org-name').focus();
    }

    function deleteOrganization(id) {
        organizations = organizations.filter(org => org.id !== id);
        saveOrganizations();
        renderOrganizationsList();
        renderNemesisOptions();
    }

    function goTo(id) {
        document.getElementById(currentScreen)?.classList.remove('active');
        document.getElementById(id)?.classList.add('active');
        window.scrollTo(0, 0);
        currentScreen = id;

        // Update desktop nav highlights
        document.querySelectorAll('.nav-link').forEach(l => {
            if (l.dataset.screen === id) {
                l.classList.remove('text-ink/50');
                l.classList.add('text-moss');
            } else {
                l.classList.remove('text-moss');
                l.classList.add('text-ink/50');
            }
        });

        // Update mobile tab highlights
        document.querySelectorAll('.tab').forEach(t => {
            t.classList.toggle('active', t.dataset.screen === id);
        });

        // Show/hide mobile tabs on all main screens
        const showTabs = ['screen-home','screen-contract','screen-shop','screen-bite'];
        document.getElementById('mobile-tabs').style.display = showTabs.includes(id) ? 'flex' : 'none';

        if (id === 'screen-bite') {
            playFailureRoast(true);
        }
    }

    function setFailureRoastStatus(message) {
        const statusEl = document.getElementById('failure-roast-status');
        if (statusEl) statusEl.textContent = message;
    }

    function setFailureRoastButton(message, disabled = false) {
        const btn = document.getElementById('failure-roast-btn');
        if (!btn) return;
        btn.disabled = disabled;
        btn.innerHTML = `<i data-lucide="volume-2" class="w-4 h-4 inline mr-1"></i> ${message}`;
        lucide.createIcons();
    }

    async function playFailureRoast(auto = false) {
        if (failureRoastLoading) return;
        failureRoastLoading = true;
        setFailureRoastButton('Loading Roast...', true);
        setFailureRoastStatus('Contacting ElevenLabs...');

        try {
            if (failureRoastAudio) {
                failureRoastAudio.pause();
                failureRoastAudio.currentTime = 0;
            }
            if (failureRoastUrl) {
                URL.revokeObjectURL(failureRoastUrl);
                failureRoastUrl = null;
            }

            const response = await fetch('/api/failure-roast', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_name: 'Erik',
                    failed_goal: 'No Wolt this week',
                    amount: '€30'
                })
            });

            if (!response.ok) {
                const err = await response.json().catch(() => ({}));
                throw new Error(err.error || err.detail || 'Failed to generate roast');
            }

            const blob = await response.blob();
            failureRoastUrl = URL.createObjectURL(blob);
            failureRoastAudio = new Audio(failureRoastUrl);
            await failureRoastAudio.play();
            setFailureRoastStatus('Now playing');
            setFailureRoastButton('Replay AI Roast');
        } catch (error) {
            setFailureRoastStatus(`Voice unavailable: ${error.message}`);
            setFailureRoastButton('Play AI Roast');
            if (!auto) {
                console.error(error);
            }
        } finally {
            failureRoastLoading = false;
        }
    }

    function updateStake(v) {
        document.getElementById('stake-display').textContent = '€' + v;
        const m = document.getElementById('stake-morkis');
        const r = document.getElementById('morkis-reaction');
        m.classList.add('wiggle');
        setTimeout(() => m.classList.remove('wiggle'), 500);
        if (v <= 20) { r.textContent = 'That all?'; r.style.color = '#AFAFAF'; }
        else if (v <= 40) { r.textContent = 'Not bad!'; r.style.color = '#006D5B'; }
        else if (v <= 70) { r.textContent = 'Now we\'re talking!'; r.style.color = '#006D5B'; }
        else { r.textContent = 'BRAVE!'; r.style.color = '#FF4B4B'; }
    }

    function setPact(t) {
        document.getElementById('pact-input').value = t;
        addPact();
    }

    function addPact() {
        const input = document.getElementById('pact-input');
        const text = input.value.trim();
        if (!text) { input.focus(); return; }
        document.getElementById('pact-text').textContent = text;
        document.getElementById('pact-display').classList.remove('hidden');
        input.style.borderColor = '#006D5B';
    }

    function signPact() {
        const input = document.getElementById('pact-input');
        const text = input.value.trim();
        if (!text) { input.focus(); return; }
        if (!organizations.length) {
            alert('Add at least one organization in Home first.');
            goTo('screen-home');
            return;
        }
        if (!selectedNemesisId) {
            alert('Select a nemesis organization first.');
            return;
        }

        const stake = document.getElementById('stake-slider').value;
        let duration = '7 days';
        document.querySelectorAll('.duration-btn').forEach(b => {
            if (b.style.background === 'rgb(0, 109, 91)' || b.classList.contains('active') && b.style.background !== 'rgb(248, 246, 240)') {
                duration = b.textContent.trim();
            }
        });
        const durationDays = parseInt(duration);

        // Find selected nemesis
        const selectedOrg = organizations.find(org => org.id === selectedNemesisId);
        const nemesis = selectedOrg?.name || 'Unknown';

        // Pick a Lucide icon based on pact text
        let iconName = 'sparkles';
        const lower = text.toLowerCase();
        if (lower.includes('wolt') || lower.includes('food') || lower.includes('pizza')) iconName = 'utensils';
        else if (lower.includes('fika') || lower.includes('coffee') || lower.includes('espresso')) iconName = 'coffee';
        else if (lower.includes('zalando') || lower.includes('shop')) iconName = 'shopping-bag';
        else if (lower.includes('alcohol') || lower.includes('booze') || lower.includes('beer') || lower.includes('drink')) iconName = 'beer';
        else if (lower.includes('gym') || lower.includes('exercise') || lower.includes('workout')) iconName = 'dumbbell';

        // Create the new pact card
        const pactCard = document.createElement('div');
        pactCard.className = 'card p-4';
        pactCard.style.borderColor = '#006D5B';
        pactCard.innerHTML = `
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-moss/10 border-2 border-moss rounded-lg flex items-center justify-center"><i data-lucide="${iconName}" class="w-5 h-5 text-moss"></i></div>
                    <div>
                        <div class="font-display text-base font-bold">${text}</div>
                        <div class="font-mono text-xs text-muted">${durationDays} days remaining</div>
                    </div>
                </div>
                <div class="font-display text-base font-extrabold text-moss">€${stake}</div>
            </div>
            <div class="w-full h-3 bg-cream border-2 border-ink/10 rounded-full overflow-hidden">
                <div class="h-full bg-moss rounded-full" style="width:5%"></div>
            </div>
            <div class="flex justify-between mt-1.5">
                <span class="font-mono text-xs text-muted">Day 1/${durationDays}</span>
                <span class="font-mono text-xs text-moss font-bold">Just started ✓</span>
            </div>
            <div class="font-mono text-xs text-muted mt-2">➜ ${nemesis}</div>
        `;

        // Insert at top of pact list
        const pactList = document.getElementById('pact-list');
        pactList.insertBefore(pactCard, pactList.firstChild);
        lucide.createIcons();

        // Reset the form
        input.value = '';
        input.style.borderColor = '';
        document.getElementById('pact-display').classList.add('hidden');
        document.getElementById('stake-slider').value = 30;
        document.getElementById('stake-display').textContent = '€30';

        // Navigate to home
        goTo('screen-home');
    }

    function clearPact() {
        document.getElementById('pact-display').classList.add('hidden');
        document.getElementById('pact-input').value = '';
        document.getElementById('pact-input').style.borderColor = '';
        document.getElementById('pact-input').focus();
    }

    // Allow Enter key in pact input
    document.getElementById('pact-input')?.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') { e.preventDefault(); addPact(); }
    });

    function selectDuration(btn) {
        document.querySelectorAll('.duration-btn').forEach(b => {
            b.style.background = '#F7F7F7'; b.style.color = '#3C3C3C'; b.style.borderColor = 'rgba(60,60,60,0.1)';
        });
        btn.style.background = '#006D5B'; btn.style.color = 'white'; btn.style.borderColor = '#006D5B';
    }

    function selectNemesis(el) {
        selectedNemesisId = el.dataset.orgId || null;
        document.querySelectorAll('.nemesis-option').forEach(o => {
            o.style.borderColor = 'rgba(60,60,60,0.1)'; o.style.background = '#F7F7F7';
            const r = o.querySelector('.nemesis-check');
            if (r) { r.style.borderColor = 'rgba(30,30,30,0.2)'; r.style.background = 'transparent'; r.textContent = ''; r.style.color = 'transparent'; r.style.fontSize = '0'; r.style.lineHeight = '1'; r.style.display = 'flex'; r.style.alignItems = 'center'; r.style.justifyContent = 'center'; }
        });
        el.style.borderColor = '#006D5B'; el.style.background = '#006D5B08';
        const r = el.querySelector('.nemesis-check');
        if (r) { r.style.borderColor = '#006D5B'; r.style.background = '#006D5B'; r.textContent = '\u2713'; r.style.color = 'white'; r.style.fontSize = '11px'; r.style.lineHeight = '1'; r.style.fontWeight = '900'; r.style.display = 'flex'; r.style.alignItems = 'center'; r.style.justifyContent = 'center'; }
    }

    // Init: mark home as active in desktop nav
    document.querySelector('.nav-link[data-screen="screen-home"]')?.classList.add('text-moss');

    loadOrganizations();
    renderOrganizationsList();
    renderNemesisOptions();

    // Init Lucide icons
    lucide.createIcons();
</script>
</body>
</html>
